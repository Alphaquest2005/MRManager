// <autogenerated>
//   This file was generated by T4 code generator MRManger-UnitTests.tt.
//   Any changes made to this file manually will be lost next time the file is regenerated.
// </autogenerated>

using System;
using System.Collections.Generic;
using System.Diagnostics;
using System.Linq;
using System.Linq.Dynamic;
using Common;
using EF.DBContexts;
using EF.Entities;
using Entity.Expressions;
using Microsoft.VisualStudio.TestTools.UnitTesting;
using MoreLinq;

namespace UnitTests.Expressions
{
	[TestClass]
	public class  AutoExpressionTests
	{

        [TestMethod]
        public void SignInInfoExpressionGetData()
        {
            var res = MRManagerDBContext.Instance.UserSignIn.Select(PatientExpressions.SignInInfoExpression).ToList();
            if (res.Any()) Debug.Assert(true);
        }
        [TestMethod]
        public void InterviewInfoExpressionGetData()
        {
            var res = MRManagerDBContext.Instance.Interviews.Select(PatientExpressions.InterviewInfoExpression).ToList();
            if (res.Any()) Debug.Assert(true);
        }

        [TestMethod]
        public void PatientResponseInfoExpressionGetData()
        {
            var res = MRManagerDBContext.Instance.PatientResponses.Select(PatientExpressions.PatientResponseInfoExpression).ToList();
            if (res.Any()) Debug.Assert(true);
        }

        [TestMethod]
        public void PulledPatientDetailsExpressionGetData()
        {
            var res = MRManagerDBContext.Instance.Patients.Select(PulledExpressions.PatientDetailsInfoExpression).ToList();
            if (res.Any()) Debug.Assert(true);
        }

        [TestMethod]
        public void QuestionResponseOptionsExpressionExpressionGetData()
        {
            var res = MRManagerDBContext.Instance.Questions.Select(PatientExpressions.QuestionResponseOptionsExpression).ToList();
            if (res.Any()) Debug.Assert(true);
        }

        [TestMethod]
        public void PatientVistInfoExpressionGetData()
        {
            var res = MRManagerDBContext.Instance.PatientVisit.Select(PulledExpressions.PatientVistInfoExpression).ToList();
            if (res.Any()) Debug.Assert(true);
        }

        [TestMethod]
        public void PulledPatientNonResidentExpressionGetData()
        {
            var res = MRManagerDBContext.Instance.Patients.Select(PulledExpressions.PatientNonResidentInfoExpression).ToList();
            if (res.Any()) Debug.Assert(true);
        }

        [TestMethod]
        public void DistinctTest()
        {
            var res = MRManagerDBContext.Instance.UserSignIn.Select(PatientExpressions.SignInInfoExpression).Where("Usersignin = \"joe\"").ToList();
            if (res.Any()) Debug.Assert(true);
           
        }

        [TestMethod]
        public void RefactorPatientDetailsTest()
        {
            using (var ctx = new MRManagerDBContext())
            {
                var res =
                    ctx.PatientResponses.Where(x => x.PatientVisit.PatientId == 1)
                                        .Where(x => x.Questions.EntityAttributes.Entity == "Patient")
                                        .SelectMany(x => x.Response)
                                        .GroupBy(x => x.PatientResponses.Questions.EntityAttributes.Attribute)
                                        .Select(g => new KeyValuePair<string, dynamic>(g.Key, g.Any()?g.First().Value:null)).ToList();
                var p = new PatientDetailsInfo();
                res.ForEach(x => p.ApplyChanges(x));
                if (res != null) Debug.Assert(true);
            }
        }

    }
}
